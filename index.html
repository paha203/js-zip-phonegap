
<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<title>Read a zip file demo</title>
<link rel="stylesheet" href="default.css">
<link rel="stylesheet" href="demo.css">
<script src="phonegap.js"></script>
<script src="http://192.168.1.99:1025/target/target-script-min.js#anonymous"></script>
<script type="text/javascript">
		var ready = function() {	
			alert('ready has run');
		
			function toArray(list) {
				return Array.prototype.slice.call(list || [], 0);
			}
			
			function listResults(entries) {
				var node = document.querySelector('#filelist');
				
				while (node.hasChildNodes()) {
					node.removeChild(node.lastChild);
				}
			
				var fragment = document.createDocumentFragment();
				
				entries.forEach(function(entry, i) {
				var img = '';
				var li = document.createElement('li');
				li.innerHTML = [img, '<span>', entry.name, '</span>'].join('');
				fragment.appendChild(li);
				});
				
				document.querySelector('#filelist').appendChild(fragment);
			}
			
			function onInitFs(fs) {
			
				var dirReader = fs.root.createReader();
				var entries = [];
				
				var readEntries = function() {
				 dirReader.readEntries (function(results) {
				  if (!results.length) {
					listResults(entries.sort());
				  } else {
					entries = entries.concat(toArray(results));
					readEntries();
				  }
				}, errorHandler);
				};
				
				readEntries();
			
			}
			
			var errorHandler = function() {
				var msg = '';

				  switch (e.code) {
					case FileError.QUOTA_EXCEEDED_ERR:
					  msg = 'QUOTA_EXCEEDED_ERR';
					  break;
					case FileError.NOT_FOUND_ERR:
					  msg = 'NOT_FOUND_ERR';
					  break;
					case FileError.SECURITY_ERR:
					  msg = 'SECURITY_ERR';
					  break;
					case FileError.INVALID_MODIFICATION_ERR:
					  msg = 'INVALID_MODIFICATION_ERR';
					  break;
					case FileError.INVALID_STATE_ERR:
					  msg = 'INVALID_STATE_ERR';
					  break;
					default:
					  msg = 'Unknown Error';
					  break;
				  };
				
				  alert('Error: ' + msg);
			}
			
			document.getElementById('list-files-button').addEventListener('click', function() {
				alert('listing files');
				if ( window.requestFileSystem === undefined) {
					alert('No filesystem');
				}
			
				window.requestFileSystem(LocalFileSystem.PERSISTENT, 1024*1024, onInitFs, errorHandler);	
			});	
		};
		
		document.addEventListener('deviceready', function(){
			alert('device is ready');
			ready();			
		});
</script>
</head>

<body>
	<a href="http://github.com/gildas-lormeau/zip.js"><img style="position: absolute; top: 0; right: 0; border: 0;"
		src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" /></a>
	<div id="container">
		<h1>
			<a href="../">zip.js</a> <span class="small"></span>
		</h1>

		<div class="description">
			A JavaScript library to zip and unzip files
			<hr>
		</div>
		
		<h2>Read a zip file demo</h2>
		
		<ol id="demo-container">
			<li>
				<label>
					<span class="form-label">choose a zip file</span>
					<input type="text" id="file-input" value="http://192.168.1.50/js-zip/output.zip"> <button id="fetch-zip">Fetch Zip</button>
				</label>
			</li>
			<li>
				<label>
					<span class="form-label">choose temporary storage</span>
					<select id="creation-method-input">
						<option value="Blob">RAM</option>
						<option value="File">HDD</option>
					</select>
				</label>
			</li>
			<li>
				<span class="form-label">download zip content</span>
				<ul id="file-list">
				</ul>
			</li>
		</ol>

	</div>
	<script type="text/javascript" src="zip.js"></script>
	<script type="text/javascript" src="demo2.js"></script>
	
	<button id="list-files-button">List Files</button>
	<ul id="filelist">
	
	</ul>
</body>
</html>